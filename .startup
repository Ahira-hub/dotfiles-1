#!/usr/bin/env sh
monitor1=eDP1
monitor2=DP1

xmodmap -e "remove control = Control_R" && xmodmap -e "add mod3 = Control_R" &

refresh() {
    xmodmap -e "remove control = Control_R" && xmodmap -e "add mod3 = Control_R" &

    #SHORTCUTS
    killall -q sxhkd
    while pgrep -x sxhkd >/dev/null; do sleep 1; done
    sxhkd -c /home/bresilla/.config/sxhkd/sxhkdrc &

    #MONITORS
    xrandr --output $monitor1 --primary --mode 3840x2160 --pos 0x1080 --output $monitor2 --mode 1920x1080 --pos 920x0 &

    #TASKBAR
    killall -q polybar &
    while pgrep -x polybar >/dev/null; do sleep 1; done
    # MONITOR=$monitor1 polybar -r -c ~/.config/polybar/polybar main &
    MONITOR=$monitor1 polybar -r -c ~/.config/polybar/polybar workspaces &
    MONITOR=$monitor2 polybar -r -c ~/.config/polybar/polybar workspaces &

    #COMPTOSITOR
    killall -q compton
    while pgrep -x compton >/dev/null; do sleep 1; done
    compton --experimental-backends --config ~/.config/compton/compton &

    #WALLPAPER
    pkill -f loopwall
    /home/bresilla/.sbin/./loopwall /home/bresilla/Sets/.wallpaper 300 &

    #NOTIFICATION
    killall -q dunst
    while pgrep -x dunst >/dev/null; do sleep 1; done
    dunst -config /home/bresilla/.config/dunst/dunst &

    #WIDGETS
    killall -q conky
    while pgrep -x conky >/dev/null; do sleep 1; done
    conky -c /home/bresilla/.config/conky/conky &
}

runonce() {
    #KEYBOARD
    xmodmap -e "remove control = Control_R" && xmodmap -e "add mod3 = Control_R" &
    xset -dpms s off &
    xset -r 118 & #Insert
    xset -r 107 & #Print
    setxkbmap de &

    #POLYKIT
    /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 &

    #SCREEN
    redshift -l 44.4949:11.3426 -b 1.0:0.8 &

    #CLIPBOARD
    greenclip daemon &

    #SSH-AGENT
    eval "$(ssh-agent)"
}

if [ "$1" == "-r" ] ;then
  refresh
else
  runonce
fi
